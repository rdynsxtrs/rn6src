Index: openssl-1.0.1t/crypto/dh/dh_key.c
===================================================================
--- openssl-1.0.1t.orig/crypto/dh/dh_key.c	2016-05-03 15:49:00.000000000 +0200
+++ openssl-1.0.1t/crypto/dh/dh_key.c	2018-06-21 09:23:46.424604879 +0200
@@ -116,10 +116,15 @@
     int ok = 0;
     int generate_new_key = 0;
     unsigned l;
-    BN_CTX *ctx;
+    BN_CTX *ctx = NULL;
     BN_MONT_CTX *mont = NULL;
     BIGNUM *pub_key = NULL, *priv_key = NULL;
 
+    if (BN_num_bits(dh->p) > OPENSSL_DH_MAX_MODULUS_BITS) {
+        DHerr(DH_F_GENERATE_KEY, DH_R_MODULUS_TOO_LARGE);
+        return 0;
+    }
+
     ctx = BN_CTX_new();
     if (ctx == NULL)
         goto err;
